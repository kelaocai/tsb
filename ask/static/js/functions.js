function _t(a,b){return"undefined"!=typeof aws_lang&&"undefined"!=typeof aws_lang[a]&&(a=aws_lang[a]),b&&(a=a.replace("%s",b)),a}function ajax_request(a,b){return $.loading("show"),b?$.post(a,b+"&_post_type=ajax",function(a){return $.loading("hide"),a?(a.err?$.alert(a.err):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload(),void 0):!1},"json").error(function(a){$.loading("hide"),""!=$.trim(a.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+a.responseText)}):$.get(a,function(a){return $.loading("hide"),a?(a.err?$.alert(a.err):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload(),void 0):!1},"json").error(function(a){$.loading("hide"),""!=$.trim(a.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+a.responseText)}),!1}function ajax_post(a,b){"function"!=typeof b&&(b=_ajax_post_processer);var c={_post_type:"ajax"};a.ajaxSubmit({dataType:"json",data:c,success:b,error:function(a){""!=$.trim(a.responseText)&&alert(_t("发生错误, 返回的信息:")+" "+a.responseText)}})}function _ajax_post_processer(a){"undefined"==typeof a.errno?$.alert(a):1!=a.errno?$.alert(a.err):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload()}function _ajax_post_modal_processer(a){"undefined"==typeof a.errno?alert(a):1!=a.errno?alert(a.err):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):$("#aw-ajax-box div.modal").modal("hide")}function _ajax_post_alert_processer(a){"undefined"==typeof a.errno?alert(a):1!=a.errno?alert(a.err):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload()}function _ajax_post_background_processer(a){"undefined"==typeof a.errno?alert(a):1!=a.errno&&$.alert(a.err)}function _ajax_post_confirm_processer(a){if("undefined"==typeof a.errno)alert(a);else if(1!=a.errno&&!confirm(a.err))return!1;1==a.errno&&a.err&&alert(a.err),a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload()}function _error_message_form_processer(a){"undefined"==typeof a.errno?alert(a):1!=a.errno?($(".error-message em").length?$(".error-message em").html(a.err):$(".error-message").html(a.err),"none"!=$(".error-message").css("display")?shake($(".error-message")):$(".error-message").fadeIn()):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload()}function shake(a){a.css({width:a.width(),"margin-left":a.css("margin-left")});for(var b=1;3>=b;b++)a.animate({left:30-10*b},20),a.animate({left:2*(30-10*b)},20)}function focus_question(a,b){a.html()?a.hasClass("aw-active")?a.html(_t("取消关注")):a.html(_t("关注")):a.hasClass("aw-active")?a.attr("data-original-title",_t("取消关注")):a.attr("data-original-title",_t("关注")),a.addClass("loading").addClass("disabled"),$.get(G_BASE_URL+"/question/ajax/focus/question_id-"+b,function(b){1==b.errno?"add"==b.rsm.type?a.removeClass("aw-active"):a.addClass("aw-active"):(b.err&&$.alert(b.err),b.rsm.url&&(window.location=decodeURIComponent(b.rsm.url))),a.removeClass("loading").removeClass("disabled")},"json")}function focus_topic(a,b){a.html()?a.hasClass("aw-active")?a.html(_t("取消关注")):a.html(_t("关注")):a.hasClass("aw-active")?a.attr("data-original-title",_t("取消关注")):a.attr("data-original-title",_t("关注")),a.addClass("loading").addClass("disabled"),$.get(G_BASE_URL+"/topic/ajax/focus_topic/topic_id-"+b,function(b){1==b.errno?"add"==b.rsm.type?a.removeClass("aw-active"):a.addClass("aw-active"):(b.err&&$.alert(b.err),b.rsm.url&&(window.location=decodeURIComponent(b.rsm.url))),a.removeClass("loading").removeClass("disabled")},"json")}function follow_people(a,b){a.html()?a.hasClass("aw-active")?a.html(_t("取消关注")):a.html(_t("关注")):a.hasClass("aw-active")?a.attr("data-original-title",_t("取消关注")):a.attr("data-original-title",_t("关注")),a.addClass("loading").addClass("disabled"),$.get(G_BASE_URL+"/follow/ajax/follow_people/uid-"+b,function(b){1==b.errno?"add"==b.rsm.type?a.removeClass("aw-active"):a.addClass("aw-active"):(b.err&&$.alert(b.err),b.rsm.url&&(window.location=decodeURIComponent(b.rsm.url))),a.removeClass("loading").removeClass("disabled")},"json")}function check_notifications(){return 0==G_USER_ID?!1:($.get(G_BASE_URL+"/home/ajax/notifications/",function(a){$("#inbox_unread").html(Number(a.rsm.inbox_num)),last_unread_notification=G_UNREAD_NOTIFICATION,G_UNREAD_NOTIFICATION=Number(a.rsm.notifications_num),G_UNREAD_NOTIFICATION>0?G_UNREAD_NOTIFICATION!=last_unread_notification&&(reload_notification_list(),$("#notifications_unread").html(G_UNREAD_NOTIFICATION)):($("#header_notification_list").length>0&&$("#header_notification_list").html('<p style="padding: 0" align="center">'+_t("没有未读通知")+"</p>"),$("#index_notification").length>0&&$("#index_notification").fadeOut(),"#tab_all_notifications".length>0&&$("#tab_all_notifications").click()),Number(a.rsm.notifications_num)>0?(document.title="("+(Number(a.rsm.notifications_num)+Number(a.rsm.inbox_num))+") "+document_title,$("#notifications_unread").show()):(document.title=document_title,$("#notifications_unread").hide()),Number(a.rsm.inbox_num)>0?$("#inbox_unread").show():$("#inbox_unread").hide(),document.title=Number(a.rsm.notifications_num)+Number(a.rsm.inbox_num)>0?"("+(Number(a.rsm.notifications_num)+Number(a.rsm.inbox_num))+") "+document_title:document_title},"json"),void 0)}function reload_notification_list(){$("#index_notification").length>0&&($("#index_notification").fadeIn().find("[name=notification_unread_num]").html(G_UNREAD_NOTIFICATION),$("#index_notification ul#notification_list").html('<p align="center" style="padding: 15px 0"><img src="'+G_STATIC_URL+'/common/loading_b.gif"/></p>'),$.get(G_BASE_URL+"/notifications/ajax/list/flag-0__page-0",function(a){$("#index_notification ul#notification_list").html(a),notification_show(5)})),$("#header_notification_list").length>0&&($("#header_notification_list").html('<p align="center">Loading...</p>'),$.get(G_BASE_URL+"/notifications/ajax/list/flag-0__limit-5__template-header_list",function(a){a.length?$("#header_notification_list").html(a):$("#header_notification_list").html('<p style="padding: 0" align="center">'+_t("没有未读通知")+"</p>")}))}function read_notification(a,b,c){var d;a?(b.remove(),notification_show(5),$("#announce_num").length>0&&$("#announce_num").html(String(G_UNREAD_NOTIFICATION-1)),$("#notifications_num").length>0&&$("#notifications_num").html(String(G_UNREAD_NOTIFICATION-1)),d=G_BASE_URL+"/notifications/ajax/read_notification/notification_id-"+a+"__read_type-1"):($("#index_notification").length>0&&$("#index_notification").fadeOut(),d=G_BASE_URL+"/notifications/ajax/read_notification/read_type-0"),$.get(d,function(){check_notifications(),c&&window.location.reload()})}function notification_show(a){if($("#index_notification").length>0){var b=0;$("#index_notification ul#notification_list li").each(function(c,d){a>c?$(d).show():$(d).hide(),b++}),0==$("#index_notification ul#notification_list li").length&&$("#index_notification").fadeOut()}}function ajax_load(a,b){$(b).html('<p style="padding: 15px 0" align="center"><img src="'+G_STATIC_URL+'/common/loading_b.gif" alt="" /></p>'),$.get(a,function(a){a.length?$(b).html(a):$(b).html('<p style="padding: 15px 0" align="center">'+_t("没有内容")+"</p>")})}function bp_more_load(a,b,c,d,e){return b.attr("id")?(d||(d=0),_bp_more_pages[b.attr("id")]=d,_bp_more_o_inners[b.attr("id")]=b.html(),b.unbind("click"),b.bind("click",function(){var f=this;return $(this).addClass("loading"),$(this).find("span").html(_t("正在载入")+"..."),$.get(a+"__page-"+_bp_more_pages[b.attr("id")],function(a){""!=$.trim(a)?(_bp_more_pages[b.attr("id")]==d&&"false"!=$(f).attr("auto-load")?c.html(a):c.append(a),_bp_more_pages[b.attr("id")]++,$(f).html(_bp_more_o_inners[b.attr("id")])):(_bp_more_pages[b.attr("id")]==d&&"false"!=$(f).attr("auto-load")&&c.html('<p style="padding: 15px 0" align="center">'+_t("没有内容")+"</p>"),$(f).addClass("disabled").unbind("click").bind("click",function(){return!1}),$(f).find("span").html(_t("没有更多了"))),$(f).removeClass("loading"),null!=e&&e()}),!1}),"false"!=b.attr("auto-load")&&b.click(),void 0):!1}function content_switcher(a,b){a.hide(),b.fadeIn()}function hightlight(a,b){var c,d;return a.hasClass(b)?!0:(c=setInterval(function(){a.addClass(b)},500),d=setInterval(function(){a.removeClass(b)},600),setTimeout(function(){clearInterval(c),clearInterval(d),a.addClass(b)},1200),setTimeout(function(){a.removeClass(b)},6e3),void 0)}function nl2br(a){return a.replace(new RegExp("\r\n|\n\r|\r|\n","g"),"<br />")}function init_img_uploader(a,b,c,d,e){return new AjaxUpload(c,{action:a,name:b,responseType:"json",onSubmit:function(a,b){return new RegExp("(png|jpe|jpg|jpeg|gif)$","i").test(b)?(this.disable(),d&&d.show(),void 0):(alert(_t("上传失败: 只支持 jpg、gif、png 格式的图片文件")),!1)},onComplete:function(a,b){this.enable(),d&&d.hide(),-1==b.errno?alert(b.err):"undefined"!=typeof e.attr("src")?e.attr("src",b.rsm.preview+"?"+Math.floor(1e4*Math.random())):e.css("background-image","url("+b.rsm.preview+"?"+Math.floor(1e4*Math.random())+")")}})}function init_avatar_uploader(a,b,c){return init_img_uploader(G_BASE_URL+"/account/ajax/avatar_upload/","user_avatar",a,b,c)}function init_fileuploader(a,b){return document.getElementById(a)?("Y"==G_UPLOAD_ENABLE&&$(".aw-upload-tips").show(),new _ajax_uploader.FileUploader({element:document.getElementById(a),action:b,debug:!1})):!1}function htmlspecialchars(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function delete_draft(a,b){$.post(G_BASE_URL+"/account/ajax/delete_draft/","item_id="+a+"&type="+b,function(a){1!=a.errno&&$.alert(a.err)},"json")}function agree_vote(a,b){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+a+"&value="+b,function(a){-1==a.errno&&$.alert(a.err)},"json")}function question_uninterested(a,b){a.fadeOut(),$.post(G_BASE_URL+"/question/ajax/uninterested/","question_id="+b,function(a){"1"!=a.errno&&alert(a.err)},"json")}function question_invite_delete(a,b){$.post(G_BASE_URL+"/question/ajax/question_invite_delete/","question_invite_id="+b,function(b){1==b.errno?a.fadeOut():alert(b.rsm.err)},"json")}function reload_comments_list(a,b,c){$("#aw-comment-box-"+c+"-"+b+" .aw-comment-list").html('<p align="center" class="aw-padding10"><i class="aw-loading"></i></p>'),$.get(G_BASE_URL+"/question/ajax/get_"+c+"_comments/"+c+"_id-"+a,function(a){$("#aw-comment-box-"+c+"-"+b+" .aw-comment-list").html(a)})}function save_comment(a){$(a).attr("_onclick",$(a).attr("onclick")).addClass("disabled").removeAttr("onclick").addClass("_save_comment"),ajax_post($(a).parents("form"),_comments_form_processer)}function _comments_form_processer(a){$.each($("a._save_comment.disabled"),function(a,b){$(b).attr("onclick",$(this).attr("_onclick")).removeAttr("_onclick").removeClass("disabled").removeClass("_save_comment")}),1!=a.errno?$.alert(a.err):(reload_comments_list(a.rsm.item_id,a.rsm.item_id,a.rsm.type_name),$("#aw-comment-box-"+a.rsm.type_name+"-"+a.rsm.item_id+" form input").val(""),$("#aw-comment-box-"+a.rsm.type_name+"-"+a.rsm.item_id+" form").fadeOut())}function remove_comment(a,b,c){$.get(G_BASE_URL+"/question/ajax/remove_comment/type-"+b+"__comment_id-"+c),$(a).parents(".aw-comment-box li").fadeOut()}function insert_attach(a,b,c){$(a).parents("form").find("textarea").insertAtCaret("\n["+c+"]"+b+"[/"+c+"]\n")}function question_thanks(a,b){$.post(G_BASE_URL+"/question/ajax/question_thanks/","question_id="+a,function(a){1!=a.errno?$.alert(a.err):"add"==a.rsm.action?($(b).html($(b).html().replace(_t("感谢"),_t("已感谢"))),$(b).removeAttr("onclick")):$(b).html($(b).html().replace(_t("已感谢"),_t("感谢")))},"json")}function answer_user_rate(a,b,c){$.post(G_BASE_URL+"/question/ajax/question_answer_rate/","type="+b+"&answer_id="+a,function(a){if(1!=a.errno)$.alert(a.err);else if(1==a.errno)switch(b){case"thanks":"add"==a.rsm.action?($(c).html($(c).html().replace(_t("感谢"),_t("已感谢"))),$(c).removeAttr("onclick")):$(c).html($(c).html().replace(_t("已感谢"),_t("感谢")));break;case"uninterested":"add"==a.rsm.action?$(c).html(_t("撤消没有帮助")):$(c).html(_t("没有帮助"))}},"json")}function init_comment_box(a){$(document).on("click",a,function(){var a,b,c;if(!$(this).attr("data-type")||!$(this).attr("data-id"))return!0;if(a="#aw-comment-box-"+$(this).attr("data-type")+"-"+$(this).attr("data-id"),$(a).length>0)"none"==$(a).css("display")?$(a).fadeIn():$(a).fadeOut();else{switch($(this).attr("data-type")){case"question":b=G_BASE_URL+"/question/ajax/save_question_comment/question_id-"+$(this).attr("data-id"),c=G_BASE_URL+"/question/ajax/get_question_comments/question_id-"+$(this).attr("data-id");break;case"answer":b=G_BASE_URL+"/question/ajax/save_answer_comment/answer_id-"+$(this).attr("data-id"),c=G_BASE_URL+"/question/ajax/get_answer_comments/answer_id-"+$(this).attr("data-id")}G_USER_ID&&"true"!=$(this).attr("data-close")?($(this).parents(".aw-item").append(Hogan.compile(AW_TEMPLATE.commentBox).render({comment_form_id:a.replace("#",""),comment_form_action:b})),$(a).find(".aw-comment-txt").bind({focus:function(){$(this).css("height",5*parseInt($(this).css("line-height"))),$(a).find(".aw-comment-box-btn").show()},blur:function(){""==$(this).val()&&($(this).css("height",parseInt($(this).css("line-height"))),$(a).find(".aw-comment-box-btn").hide())}}),$(a).find(".close-comment-box").click(function(){$(a).fadeOut(),$(a).find(".aw-comment-txt").css("height",$(this).css("line-height"))})):$(this).parent().parent().append(Hogan.compile(AW_TEMPLATE.commentBoxClose).render({comment_form_id:a.replace("#",""),comment_form_action:b})),$.get(c,function(b){b||(b='<div align="center" class="aw-padding10">'+_t("暂无评论")+"</div>"),$(a).find(".aw-comment-list").html(b)}),$(this).width()/2+$(this).prev().width(),$(a).find(".i-comment-triangle").css("left",$(this).width()/2+$(this).prev().width()+15)}at_user_lists($(this).parents(".aw-item").find(".aw-comment-txt"))})}function insertVoteBar(a){switch(a.flag){case 1:up_class="active",down_class="";break;case-1:up_class="",down_class="active";break;case 0:up_class="",down_class=""}$(a.element).parent().prepend(Hogan.compile(AW_TEMPLATE.voteBar).render({agree_count:a.agree_count,up_class:up_class,down_class:down_class,user_name:a.user_name,answer_id:a.answer_id})),$(a.element).detach()}function agreeVote(a,b,c){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+c+"&value=1",function(){}),$(a).parents(".aw-item").find(".aw-agree-by").text().match(b)?($.each($(a).parents(".aw-item").find(".aw-user-name"),function(a,c){$(c).html()==b&&($(c).prev()?$(c).prev().remove():$(c).next().remove(),$(c).remove())}),$(a).removeClass("active"),0!=parseInt($(a).parents(".aw-item").find(".aw-vote-bar-count").html())&&$(a).parents(".aw-item").find(".aw-vote-bar-count").html(parseInt($(a).parents(".aw-item").find(".aw-vote-bar-count").html())-1),0==$(a).parents(".aw-item").find(".aw-agree-by a").length&&$(a).parents(".aw-item").find(".aw-agree-by").hide()):(0==$(a).parents(".aw-item").find(".aw-agree-by .aw-user-name").length?$(a).parents(".aw-item").find(".aw-agree-by").append('<a class="aw-user-name">'+b+"</a>"):$(a).parents(".aw-item").find(".aw-agree-by").append('<em>、</em><a class="aw-user-name">'+b+"</a>"),$(a).parents(".aw-item").find(".aw-vote-bar-count").html(parseInt($(a).parents(".aw-item").find(".aw-vote-bar-count").html())+1),$(a).parents(".aw-item").find(".aw-agree-by").show(),$(a).parents(".aw-item").find("a.active").removeClass("active"),$(a).addClass("active"))}function disagreeVote(a,b,c){$.post(G_BASE_URL+"/question/ajax/answer_vote/","answer_id="+c+"&value=-1",function(){}),$(a).hasClass("active")?$(a).removeClass("active"):($.each($(a).parents(".aw-item").find(".aw-user-name"),function(a,c){$(c).html()==b&&($(c).prev()?$(c).prev().remove():$(c).next().remove(),$(c).remove())}),$(a).prev().prev().hasClass("active")&&0!=parseInt($(a).parents(".aw-item").find(".aw-vote-bar-count").html())&&$(a).parents(".aw-item").find(".aw-vote-bar-count").html(parseInt($(a).parents(".aw-item").find(".aw-vote-bar-count").html())-1),$(a).parents(".aw-item").find("a.active").removeClass("active"),$(a).addClass("active"),0==$(a).parents(".aw-item").find(".aw-agree-by a").length&&$(a).parents(".aw-item").find(".aw-agree-by").hide())}function init_topic_edit_box(a){$(a).click(function(){var a,b,c;$(this).parents(".aw-item").css("z-index",1e3),a=$(this).parents(".aw-topic-editor"),b=a.attr("data-id"),c=a.attr("data-type"),a.find(".aw-topic-name").children().hasClass("i-close-hover")?a.find(".i-close-hover").show():(a.find(".aw-topic-name").children().append('<i class="aw-icon i-close-hover"></i>'),$.each(a.find(".i-close-hover"),function(a,d){$(d).click(function(){switch(c){case"question":$.post(G_BASE_URL+"/question/ajax/delete_topic/","question_id="+b+"&topic_id="+$(this).parents(".aw-topic-name").attr("data-id"),function(){$("#aw-ajax-box").empty()});break;case"topic":$.get(G_BASE_URL+"/topic/ajax/remove_related_topic/related_id-"+$(this).parents(".aw-topic-name").attr("data-id")+"__topic_id-"+b);break;case"favorite":$.post(G_BASE_URL+"/favorite/ajax/remove_favorite_tag/","answer_id="+b+"&tags="+$(this).parents(".aw-topic-name").text())}return $(this).parents(".aw-topic-name").remove(),!1})})),0==a.find(".aw-edit-topic-box").length&&(a.append(AW_TEMPLATE.editTopicBox),a.find(".close-edit").click(function(){a.find(".aw-edit-topic-box").hide(),a.find(".i-close-hover").hide(),a.find(".aw-edit-topic").show(),$(this).parents(".aw-item").attr("style","")}),a.find(".submit-edit").click(function(){if(""!=a.find("#aw_edit_topic_title").val())switch(c){case"publish":a.prepend('<a href="javascript:;" class="aw-topic-name"><span>'+a.find("#aw_edit_topic_title").val()+'<i class="aw-icon i-close-hover" onclick="$(this).parents(\'.aw-topic-name\').remove();"></i></span><input type="hidden" value="'+a.find("#aw_edit_topic_title").val()+'" name="topics[]" /></a>').hide().fadeIn(),a.find("#aw_edit_topic_title").val("");break;case"question":$.post(G_BASE_URL+"/question/ajax/save_topic/question_id-"+b,"topic_title="+a.find("#aw_edit_topic_title").val(),function(c){return 1!=c.errno?($.alert(c.err),!1):(a.prepend('<a href="'+G_BASE_URL+"/topic/"+c.rsm.topic_id+'" class="aw-topic-name"><span>'+a.find("#aw_edit_topic_title").val()+"<i class=\"aw-icon i-close-hover\" onclick=\"$.post(G_BASE_URL + '/question/ajax/delete_topic/', 'question_id="+b+"&topic_id=' + $(this).parents('.aw-topic-name').attr('data-id'));$(this).parents('.aw-topic-name').remove();return false;\"></i></span></a>").hide().fadeIn(),a.find("#aw_edit_topic_title").val(""),void 0)},"json");break;case"topic":$.post(G_BASE_URL+"/topic/ajax/save_related_topic/topic_id-"+b,"topic_title="+a.find("#aw_edit_topic_title").val(),function(c){return 1!=c.errno?($.alert(c.err),!1):(a.prepend('<a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(a.find("#aw_edit_topic_title").val())+'" class="aw-topic-name"><span>'+a.find("#aw_edit_topic_title").val()+"<i class=\"aw-icon i-close-hover\" onclick=\"$.post(G_BASE_URL + '/topic/ajax/remove_related_topic/related_id-' + $(this).parents('.aw-topic-name').text() + '&topic_id="+b+"');$(this).parents('.aw-topic-name').remove();return false;\"></i></span></a>").hide().fadeIn(),a.find("#aw_edit_topic_title").val(""),void 0)},"json");break;case"favorite":$.post(G_BASE_URL+"/favorite/ajax/update_favorite_tag/","answer_id="+b+"&tags="+a.find("#aw_edit_topic_title").val(),function(c){return 1!=c.errno?($.alert(c.err),!1):(a.prepend('<a href="'+G_BASE_URL+"/favorite/tag-"+encodeURIComponent(a.find("#aw_edit_topic_title").val())+'" class="aw-topic-name"><span>'+a.find("#aw_edit_topic_title").val()+"<i class=\"aw-icon i-close-hover\" onclick=\"$.post(G_BASE_URL + '/favorite/ajax/remove_favorite_tag/', 'answer_id="+b+"&topic_id=' + $(this).parents('.aw-topic-name').text());$(this).parents('.aw-topic-name').remove();return false;\"></i></span></a>").hide().fadeIn(),a.find("#aw_edit_topic_title").val(""),void 0)},"json")}})),$(this).parent().find(".aw-edit-topic-box").fadeIn(),$(this).hide()})}function dragBox(a){$(a).mousedown(function(a){var b=a.clientX-$(this).offset().left,c=a.clientY-$(this).offset().top,d=$(this);$(document).on({mousemove:function(a){var e=a.clientX-b,f=a.clientY-c;d.parent().css({left:e,top:f})},mouseup:function(){$(document).unbind("mousemove"),$(document).unbind("mouseup")}})})}function show_card_box(a,b,c){c=c?c:300,$(document).on("mouseover",a,function(){clearTimeout(cardBoxTimeout);var a=$(this),d=a.offset().top-$(window).scrollTop(),e=$(window).width()-a.offset().left,f=$(window).height()-a.height()-d;card_box_show=setTimeout(function(){function d(b,c){"user"==b&&$.ajax({type:"GET",url:G_BASE_URL+c+a.attr("data-id"),dataType:"json",success:function(a){var c,b=a.focus,d=a.verified;1==b?(b="",c="取消关注"):(b="aw-active",c="关注"),d&&(d="active"),"enterprise"==a.verified?(verified_enterprise="i-ve",verified_title="企业认证"):"personal"==a.verified?(verified_enterprise="icon-v",verified_title="个人认证"):verified_enterprise=verified_title="",$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.userCard).render({verified:d,verified_enterprise:verified_enterprise,verified_title:verified_title,uid:a.uid,avatar_file:a.avatar_file,user_name:a.user_name,reputation:a.reputation,agree_count:a.agree_count,signature:a.signature,url:a.url,category_enable:a.category_enable,focus:b,focusTxt:c})),(0==G_USER_ID||G_USER_ID==a.uid)&&$("#aw-card-tips .aw-mod-footer").hide(),h(),cashUserData.push($("#aw-ajax-box").html())}}),"topic"==b&&$.ajax({type:"GET",url:G_BASE_URL+c+a.attr("data-id"),dataType:"json",success:function(a){var c,b=a.focus;b>0?(b="",c=_t("取消关注")):(b="aw-active",c=_t("关注")),$("#aw-ajax-box").html(Hogan.compile(AW_TEMPLATE.topicCard).render({topic_id:a.topic_id,topic_pic:a.topic_pic,topic_title:a.topic_title,topic_description:a.topic_description,discuss_count:a.discuss_count,focus_count:a.focus_count,focus:b,focusTxt:c,url:a.url})),0==G_USER_ID&&$("#aw-card-tips .aw-mod-footer .focus").hide(),h(),cashTopicData.push($("#aw-ajax-box").html())}})}function g(b){"user"==b&&$.each(cashUserData,function(b,d){d.match('data-id="'+a.attr("data-id")+'"')&&($("#aw-ajax-box").html(d),$("#aw-card-tips").removeAttr("style"),h(),c=1)}),"topic"==b&&$.each(cashTopicData,function(b,d){d.match('data-id="'+a.attr("data-id")+'"')&&($("#aw-ajax-box").html(d),$("#aw-card-tips").removeAttr("style"),h(),c=1)})}function h(){$("#aw-card-tips").css({left:a.offset().left,top:a.offset().top+a.height()+2}).fadeIn(),$("#aw-card-tips").height()+32>f&&($("#aw-card-tips").width()+32>e?$("#aw-card-tips").css({left:a.offset().left-$("#aw-card-tips").width()+32,top:a.offset().top-($("#aw-card-tips").height()+32)-a.height()/3}).fadeIn():$("#aw-card-tips").css({left:a.offset().left,top:a.offset().top-($("#aw-card-tips").height()+32)-a.height()/3}).fadeIn()),$("#aw-card-tips").width()+32>e&&($("#aw-card-tips").height()+32>f?$("#aw-card-tips").css({left:a.offset().left-$("#aw-card-tips").width()+32,top:a.offset().top-($("#aw-card-tips").height()+32)-a.height()/3}).fadeIn():$("#aw-card-tips").css({left:a.offset().left-$("#aw-card-tips").width()+32,top:a.offset().top+a.height()+3}).fadeIn())}var c;"user"==b&&a.attr("data-id")&&(0==cashUserData.length?d("user","/people/ajax/user_info/uid-"):(c=0,g("user"),0==c&&d("user","/people/ajax/user_info/uid-"))),"topic"==b&&a.attr("data-id")&&(0==cashTopicData.length?d("topic","/topic/ajax/topic_info/topic_id-"):(c=0,g("topic"),0==c&&d("topic","/topic/ajax/topic_info/topic_id-")))},c)}),$(document).on("mouseout",a,function(){clearTimeout(card_box_show),cardBoxTimeout=setTimeout(function(){$("#aw-card-tips").fadeOut()},600)})}function search_tips(a,b){var c;$(a).on({focus:function(){$(".aw-search-dropdown-box").show().children(".aw-search-dropdown-list").empty(),$(".aw-search-dropdown-box .i-dropdown-triangle").css("left",$(this).width()/2+50),$(".aw-search-dropdown-box .title").text(_t("输入关键字进行搜索")).show(),$(".aw-search-dropdown-box .search").hide().children("a").text(""),$(".aw-search-dropdown-box .txt").text("")},keyup:function(){$(this).val().length>=2?($.ajax({type:"GET",url:G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent($(this).val())+"&limit="+b,dataType:"json",success:function(a){$(".aw-search-dropdown-box .aw-search-dropdown-list").html("");for(var b=0;b<a.length;b++)add_search_dropdown_list(".aw-search-dropdown-box .aw-search-dropdown-list",parseInt(a[b].type),a[b],c)}}),$(".aw-search-dropdown-box .search").show().children("a").text($(this).val()),$(".aw-search-dropdown-box .title").hide()):($(".aw-search-dropdown-box .title").text(_t("请输入两个以上关键字...")).show(),$(".aw-search-dropdown-box .search").hide(),$(".aw-search-dropdown-box .aw-search-dropdown-list").empty()),$(".aw-search-dropdown-box .txt").text($(this).val()),c=$(this).val()},blur:function(){searchtimeout=setTimeout(function(){$(".aw-search-dropdown-box").hide()},300)}})}function add_search_dropdown_list(a,b,c,d){var e,f;switch(b){case 1:e=c.detail.best_answer>0?"active":"",$(a).append(Hogan.compile(AW_TEMPLATE.searchDropdownList1).render({url:G_BASE_URL+"/"+c.url,active:e,content:c.name,discuss_count:c.detail.answer_count})),$(".aw-search-dropdown-list .question a").highText(d,"span","active");break;case 2:$(a).append(Hogan.compile(AW_TEMPLATE.searchDropdownList2).render({url:G_BASE_URL+"/"+c.url,name:c.name,discuss_count:c.detail.discuss_count,topic_id:c.detail.topic_id}));break;case 3:f=""==c.detail.signature?_t("暂无介绍"):c.detail.signature,$(a).append(Hogan.compile(AW_TEMPLATE.searchDropdownList3).render({url:G_BASE_URL+"/"+c.url,uid:c.uid,img:c.detail.avatar_file,name:c.name,intro:f}))}}function get_topic_list_data(a,b){188==a.which?","!=$(".aw-edit-topic-box #aw_edit_topic_title").val()?($(".aw-edit-topic-box #aw_edit_topic_title").val($(".aw-edit-topic-box #aw_edit_topic_title").val().substring(0,$(".aw-edit-topic-box #aw_edit_topic_title").val().length-1)),$(".aw-edit-topic-box .aw-topic-dropdown").hide(),$(".aw-edit-topic-box .submit-edit").click()):$(".aw-edit-topic-box #aw_edit_topic_title").val(""):($(".aw-edit-topic-box .aw-topic-dropdown").css("width",$(".aw-edit-topic-box #aw_edit_topic_title").width()+12),b.length>=2?$.get(G_BASE_URL+"/search/ajax/search/?type-topic__q-"+encodeURIComponent(b)+"__limit-10",function(a){0!=a.length?($(".aw-edit-topic-box .aw-topic-dropdown-list").empty(),$.each(a,function(a,b){$(".aw-edit-topic-box .aw-topic-dropdown .aw-topic-dropdown-list").append(Hogan.compile(AW_TEMPLATE.editTopicDorpdownList).render({name:b.name}))}),$(".aw-edit-topic-box .aw-topic-dropdown").show().children().show(),$(".aw-edit-topic-box .aw-topic-dropdown .title").hide(),$(".aw-edit-topic-box .aw-topic-dropdown-list li a").highText(b,"span","active")):($(".aw-edit-topic-box .aw-topic-dropdown").show().children(".title").html(_t("没有找到相关结果")).show(),$(".aw-edit-topic-box .aw-topic-dropdown-list").hide())},"json"):b.length>0&&b.length<2?($(".aw-edit-topic-box .aw-topic-dropdown-list").hide(),$(".aw-edit-topic-box .aw-topic-dropdown").show().children(".title").html(_t("请输入两个以上关键字...")).show()):$(".aw-edit-topic-box .aw-topic-dropdown").hide())}function hide_topic_list(){setTimeout(function(){$(".aw-edit-topic-box .aw-topic-dropdown").hide()},300)}function get_question_list_data(a){$(".aw-question-drodpwon .aw-topic-dropdown").css("width",$(".aw-question-drodpwon #question-input").width()+12),a.length>=2?$.get(G_BASE_URL+"/search/ajax/search/?q="+encodeURIComponent(a)+"&type=question&limit-30",function(b){0!=b.length?($(".aw-question-drodpwon .aw-question-dropdown-list").empty(),$.each(b,function(a,b){$(".aw-question-drodpwon .aw-question-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionRedirectList).render({url:"'"+G_BASE_URL+"/question/ajax/redirect/', 'item_id="+$(".aw-question-drodpwon #question-input").attr("data-id")+"&target_id="+b.sno+"'",name:b.name}))}),$(".aw-question-drodpwon .aw-topic-dropdown").show().children().show(),$(".aw-question-drodpwon .aw-topic-dropdown .title").hide(),$(".aw-question-drodpwon .aw-question-dropdown-list li a").highText(a,"span","active")):($(".aw-question-drodpwon .aw-topic-dropdown").show().children(".title").html(_t("没有找到相关结果")).show(),$(".aw-question-drodpwon .aw-topic-dropdown .aw-question-dropdown-list").hide())},"json"):a.length>0&&a.length<2?($(".aw-question-drodpwon .aw-topic-dropdown").show().children(".title").html(_t("请输入两个以上关键字...")).show(),$(".aw-question-drodpwon .aw-topic-dropdown .aw-question-dropdown-list").hide()):$(".aw-question-drodpwon .aw-topic-dropdown").hide()}function hide_question_list(a){setTimeout(function(){a.next().hide()},300)}function get_topic_question_list_data(a){$(".aw-question-drodpwon .aw-question-dropdown").css("width",$(".aw-topic-search").width()),a.length>=2?($(".aw-question-drodpwon .aw-question-dropdown-list").html(""),$.get(G_BASE_URL+"/search/ajax/search/?type=question&q="+encodeURIComponent(a)+"&topic_ids="+CONTENTS_TOPIC_ID,function(b){0!=b.length?($.each(b,function(a,b){$(".aw-topic-search .aw-question-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:G_BASE_URL+"/"+b.url,name:b.name}))}),$(".aw-question-drodpwon .aw-topic-dropdown").show().children().show(),$(".aw-question-drodpwon .aw-topic-dropdown .title").hide(),$(".aw-topic-search .aw-question-dropdown-list li a").highText(a,"span","active")):($(".aw-question-drodpwon .aw-topic-dropdown").show().children(".title").html(_t("没有找到相关结果")).show(),$(".aw-question-drodpwon .aw-topic-dropdown .aw-question-dropdown-list").hide())},"json")):a.length>0&&a.length<2?($(".aw-question-drodpwon .aw-topic-dropdown .aw-question-dropdown-list").hide(),$(".aw-question-drodpwon .aw-topic-dropdown").show().children(".title").html(_t("请输入两个以上关键字...")).show()):$(".aw-question-drodpwon .aw-topic-dropdown").hide()}function hide_topic_question_list(){$(".aw-question-drodpwon .aw-topic-dropdown").delay(300).hide(0)}function get_quick_publich_question_list(a,b){clearTimeout(qDropdownTimeout);var c=a;a.next().css("width",a.width()+12),b.length>=2?$.get(G_BASE_URL+"/search/ajax/search/?type=question&q="+encodeURIComponent(b)+"&limit-10",function(d){0!=d.length?(a.next().find(".aw-question-dropdown-list").html(""),$.each(d,function(b,c){a.next().find(".aw-question-dropdown-list").append(Hogan.compile(AW_TEMPLATE.questionDropdownList).render({url:G_BASE_URL+"/"+c.url,name:c.name}))}),a.next().show().children().show(),a.next().find(".title").hide(),$(".aw-publish-box .aw-question-dropdown-list li a").highText(b,"span","active")):(a.next().show().children(".title").html(_t("没有找到相关结果")).show(),a.next().find(".aw-question-dropdown-list").hide()),qDropdownTimeout=setTimeout(function(){c.next().hide()},2e3)},"json"):b.length>0&&b.length<2?(a.next().find(".aw-question-dropdown-list").hide(),a.next().show().children(".title").html(_t("请输入两个以上关键字...")).show()):a.next().hide()}function get_user_list_data(a,b){a.parents(".alert-box")[0]&&a.next().css({top:a.offset().top-a.parents(".alert-box").offset().top}),a.next().css({width:a.width()+12}),b.length>=2?$.get(G_BASE_URL+"/search/ajax/search/?type-user__q-"+encodeURIComponent(b)+"__limit-10",function(b){0!=b.length?(a.next().find(".aw-user-dropdown-list").html(""),$.each(b,function(b,c){a.next().find(".aw-user-dropdown-list").append(Hogan.compile(AW_TEMPLATE.inviteDropdownList).render({uid:c.uid,name:c.name,img:c.detail.avatar_file}))}),a.next().show().children().show(),a.next().find(".title").hide()):(a.next().show().children(".title").html(_t("没有找到相关结果")).show(),a.next().find(".aw-user-dropdown-list").hide())},"json"):b.length>0&&b.length<2?(a.next().find(".aw-user-dropdown-list").hide(),a.next().show().children(".title").html(_t("请输入两个以上关键字...")).show()):a.next().hide()}function invite_user(a,b,c){var d=a;$.post(G_BASE_URL+"/question/ajax/save_invite/",{question_id:QUESTION_ID,uid:a.attr("data-id")},function(a){-1!=a.errno?($(".aw-side-bar-invite-box .aw-side-bar-invite-list").append(Hogan.compile(AW_TEMPLATE.inviteUserList).render({uid:d.attr("data-id"),img:c,name:b})),$(".aw-side-bar-invite-replay .aw-message-tooltip").text(parseInt($(".aw-side-bar-invite-replay .aw-message-tooltip").text())+1),$(".aw-side-bar-invite-replay .aw-side-bar-invite-box div").eq(0).show()):-1==a.errno&&$(".aw-side-bar-invite-box .error-message").html("<em>"+a.err+"</em>").show()
},"json")}function disinvite_user(a,b){$.get(G_BASE_URL+"/question/ajax/cancel_question_invite/question_id-"+QUESTION_ID+"__recipients_uid-"+b),$(".aw-side-bar-invite-replay .aw-message-tooltip").text(parseInt($(".aw-side-bar-invite-replay .aw-message-tooltip").text())-1)}function add_dropdown_list(a,b,c){$(a).append(Hogan.compile(AW_TEMPLATE.dropdownList).render({items:b})),$(a+" .dropdown-menu li a").click(function(){$("#aw-topic-tags-select").html($(this).text())}),c&&$(a+" .dropdown-menu li a[data-value='"+c+"']").click()}function _quick_publish_processer(a){"undefined"==typeof a.errno?alert(a):1!=a.errno?($("#quick_publish_error em").html(a.err),$("#quick_publish_error").fadeIn()):a.rsm&&a.rsm.url?window.location=decodeURIComponent(a.rsm.url):window.location.reload()}function _fix_textarea_focus_cursor_position(a){if(/MSIE/.test(navigator.userAgent)||/Opera/.test(navigator.userAgent)){var b=a.createTextRange();b.text=a.value,b.collapse(!1)}else/WebKit/.test(navigator.userAgent)&&(a.select(),window.getSelection().collapseToEnd())}function verify_register_form(a){$(a).find(":text, :input").on({focus:function(){("undefined"!=$(this).attr("tips")||""!=$(this).attr("tips"))&&$(this).parent().append('<span class="aw-reg-tips">'+$(this).attr("tips")+"</span>")},blur:function(){var a,b,c;switch($(this).attr("name")){case"user_name":return a=$(this),$(this).parent().find(".aw-reg-tips").detach(),$(this).val().length>=0&&$(this).val().length<2?($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0):$(this).val().length>17?($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0):($.get(G_BASE_URL+"/account/ajax/check_username/username"+"-"+encodeURIComponent($(this).val()),function(b){-1==b.errno?(a.parent().find(".aw-reg-tips").detach(),a.parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+b.err+"</span>")):(a.parent().find(".aw-reg-tips").detach(),a.parent().append('<span class="aw-reg-tips aw-reg-right"><i class="aw-icon i-followed"></i></span>'))},"json"),void 0);case"email":return $(this).parent().find(".aw-reg-tips").detach(),b=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/,b.test($(this).val())?($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-right"><i class="aw-icon i-followed"></i></span>'),void 0):($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0);case"mobile":return $(this).parent().find(".aw-reg-tips").detach(),a=$(this),c=/^1(3|5|8)\d{9}$/,c.test($(this).val())?($.get(G_BASE_URL+"/account/ajax/check_mobile/mobile"+"-"+encodeURIComponent($(this).val()),function(b){-1==b.errno?(a.parent().find(".aw-reg-tips").detach(),a.parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+b.err+"</span>")):(a.parent().find(".aw-reg-tips").detach(),a.parent().append('<span class="aw-reg-tips aw-reg-right"><i class="aw-icon i-followed"></i></span>'))},"json"),void 0):($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0);case"authcode":if($(this).parent().find(".aw-reg-tips").detach(),6!=$(this).val().length)return $(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0;return;case"password":return $(this).parent().find(".aw-reg-tips").detach(),$(this).val().length>=0&&$(this).val().length<6?($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0):$(this).val().length>17?($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-err"><i class="aw-icon i-err"></i>'+$(this).attr("errortips")+"</span>"),void 0):($(this).parent().find(".aw-reg-tips").detach(),$(this).parent().append('<span class="aw-reg-tips aw-reg-right"><i class="aw-icon i-followed"></i></span>'),void 0)}}})}function at_user_lists(a){function b(){$(".content_cursor")[0]||$("#aw-ajax-box").append('<span class="content_cursor"></span>'),$("#aw-ajax-box").find(".content_cursor").css({left:parseInt($(a).offset().left+parseInt($(a).css("padding-left"))+2),top:parseInt($(a).offset().top+parseInt($(a).css("padding-left")))})}function c(){$(".aw-invite-dropdown").css({left:$(".cursor_flag").offset().left,top:$(".cursor_flag").offset().top+20})}$(a).keyup(function(d){var e,f,g,h,i,j;if(b(),e=$(this),f=getCursorPosition($(this)[0]).start,g=d.which,h=$(this).get(0),"@"==$(this).val().charAt(f-1))$(".content_cursor").html("").append($(this).val().substring(0,h.selectionStart).replace(/\n/g,"<br>")+'<b class="cursor_flag">flag</b>'),$(".aw-invite-dropdown")[0]||$("#aw-ajax-box").append('<ul class="aw-invite-dropdown"></ul>');else switch(g){case 38:at_user_lists_index==$(".aw-invite-dropdown li").length&&at_user_lists_index--,0==at_user_lists_index?($(".aw-invite-dropdown li:last").addClass("active").siblings().removeClass("active"),at_user_lists_index=$(".aw-invite-dropdown li").length):($(".aw-invite-dropdown li").eq(at_user_lists_index-1).addClass("active").siblings().removeClass("active"),at_user_lists_index--);break;case 40:0==at_user_lists_flag?($(".aw-invite-dropdown li:first").addClass("active").siblings().removeClass("active"),at_user_lists_flag=1):at_user_lists_index+1>=$(".aw-invite-dropdown li").length?($(".aw-invite-dropdown li:first").addClass("active").siblings().removeClass("active"),at_user_lists_index=0):($(".aw-invite-dropdown li").eq(at_user_lists_index+1).addClass("active").siblings().removeClass("active"),at_user_lists_index++);break;case 13:$(".aw-invite-dropdown li").eq(at_user_lists_index).click();break;default:if($(".aw-invite-dropdown")[0]){for(i=0,j=f;j--;)if("@"==$(this).val().charAt(j)){i=j;break}if($(this).val().substring(f,i).replace("@","").match(/\s/))return $(".aw-invite-dropdown, .i-invite-triangle").addClass("hide"),!1;$.get(G_BASE_URL+"/search/ajax/search/?type-user__q-"+encodeURIComponent($(this).val().substring(f,i).replace("@",""))+"__limit-10",function(a){$(".aw-invite-dropdown")[0]&&(0!=a.length?($(".aw-invite-dropdown").html(""),$.each(a,function(a,b){$(".aw-invite-dropdown").append('<li><img src="'+b.detail.avatar_file+'"/><a>'+b.name+"</a></li>")}),c(),$(".aw-invite-dropdown").removeClass("hide"),$(".aw-invite-dropdown li").click(function(){e.val(e.val().substring(0,i)+"@"+$(this).find("a").html()+" ").focus(),_fix_textarea_focus_cursor_position(e),at_user_lists_index=0,at_user_lists_flag=0,$(".aw-invite-dropdown").detach()})):$(".aw-invite-dropdown").addClass("hide")),0==e.val().length&&$(".aw-invite-dropdown").addClass("hide")},"json")}}"#advanced_editor"==a&&""==$(this).val()&&$("#markItUpPreviewFrames").html("")}),$(a).keydown(function(a){var b=a.which;return $(".aw-invite-dropdown").is(":visible")?38==b||40==b||13==b?!1:void 0:!0})}function getCursorPosition(a){var c,d,e,b={text:"",start:0,end:0};if(a.focus(),a.setSelectionRange)b.start=a.selectionStart,b.end=a.selectionEnd,b.text=b.start!=b.end?a.value.substring(b.start,b.end):"";else if(document.selection){for(d=document.selection.createRange(),e=document.body.createTextRange(),e.moveToElementText(a),b.text=d.text,b.bookmark=d.getBookmark(),c=0;e.compareEndPoints("StartToStart",d)<0&&0!==d.moveStart("character",-1);c++)"\n"==a.value.charAt(c)&&c++;b.start=c,b.end=b.text.length+b.start}return b}var cardBoxTimeout,qDropdownTimeout,_bp_more_o_inners=new Array,_bp_more_pages=new Array,cashUserData=[],cashTopicData=[],at_user_lists_flag=0,at_user_lists_index=0;